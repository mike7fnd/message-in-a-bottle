{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/data.ts"],"sourcesContent":["\n'use server';\n\nimport { getApp, getApps, initializeApp } from 'firebase-admin/app';\nimport {\n  getFirestore,\n  type FieldValue,\n  type Timestamp,\n} from 'firebase-admin/firestore';\nimport { revalidatePath } from 'next/cache';\nimport { v4 as uuidv4 } from 'uuid';\n\n// Initialize Firebase Admin SDK for server-side operations\nif (!getApps().length) {\n  initializeApp();\n}\n\nconst db = getFirestore();\n// Correctly get the serverTimestamp function\nconst { serverTimestamp } = await import('firebase-admin/firestore');\n\nexport type Message = {\n  id: string;\n  content: string;\n  recipient: string;\n  timestamp: any; // Firestore timestamp\n  senderId?: string; // Optional sender ID for anonymous messages\n  isPolished?: boolean;\n};\n\nexport type Recipient = {\n  name: string;\n  messageCount: number;\n};\n\n// This function is called from a Server Action, so it uses the admin SDK.\nexport async function addMessage(\n  content: string,\n  recipient: string\n): Promise<Message> {\n  const messageId = uuidv4();\n  const newMessage: Omit<Message, 'timestamp' | 'id'> & {\n    id: string;\n    timestamp: FieldValue;\n  } = {\n    id: messageId,\n    content,\n    recipient: recipient.toLowerCase().trim(),\n    timestamp: serverTimestamp(),\n    // We can add a senderId if we have authenticated users\n  };\n\n  await db.collection('public_messages').doc(messageId).set(newMessage);\n\n  revalidatePath('/browse');\n  revalidatePath(`/bottle/${recipient}`);\n\n  // Optimistically return the message shape\n  return {\n    ...newMessage,\n    timestamp: new Date(), // Return a local date for immediate UI feedback\n  };\n}\n\n// These functions are called from Server Components, they use the admin SDK.\nexport async function getMessagesForRecipient(\n  recipient: string\n): Promise<Message[]> {\n  const q = db\n    .collection('public_messages')\n    .where('recipient', '==', recipient.toLowerCase().trim());\n  const querySnapshot = await q.get();\n  const messages: Message[] = [];\n  querySnapshot.forEach((doc) => {\n    const data = doc.data();\n    const timestamp = data.timestamp as Timestamp;\n    messages.push({\n      id: doc.id,\n      content: data.content,\n      recipient: data.recipient,\n      timestamp: timestamp?.toDate(), // Convert Firestore Timestamp to Date\n    });\n  });\n  return messages.sort((a, b) => b.timestamp - a.timestamp);\n}\n\nexport async function getMessageById(id: string): Promise<Message | undefined> {\n  const docRef = db.collection('public_messages').doc(id);\n  const docSnap = await docRef.get();\n\n  if (docSnap.exists) {\n    const data = docSnap.data();\n    if (data) {\n      const timestamp = data.timestamp as Timestamp;\n      return {\n        id: docSnap.id,\n        content: data.content,\n        recipient: data.recipient,\n        timestamp: timestamp?.toDate(),\n      };\n    }\n  } else {\n    return undefined;\n  }\n}\n\nexport async function getRecipients(): Promise<Recipient[]> {\n  const querySnapshot = await db.collection('public_messages').get();\n  const recipientMap = new Map<string, number>();\n\n  querySnapshot.forEach((doc) => {\n    const recipient = doc.data().recipient;\n    if (recipient) {\n      recipientMap.set(recipient, (recipientMap.get(recipient) || 0) + 1);\n    }\n  });\n\n  return Array.from(recipientMap.entries()).map(([name, messageCount]) => ({\n    name,\n    messageCount,\n  }));\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAGA;AACA;AAKA;AACA;;;;;;;;;;;;AAEA,2DAA2D;AAC3D,IAAI,CAAC,IAAA,2JAAO,IAAG,MAAM,EAAE;IACrB,IAAA,iKAAa;AACf;AAEA,MAAM,KAAK,IAAA,4KAAY;AACvB,6CAA6C;AAC7C,MAAM,EAAE,eAAe,EAAE,GAAG;AAiBrB,eAAe,WACpB,OAAe,EACf,SAAiB;IAEjB,MAAM,YAAY,IAAA,wLAAM;IACxB,MAAM,aAGF;QACF,IAAI;QACJ;QACA,WAAW,UAAU,WAAW,GAAG,IAAI;QACvC,WAAW;IAEb;IAEA,MAAM,GAAG,UAAU,CAAC,mBAAmB,GAAG,CAAC,WAAW,GAAG,CAAC;IAE1D,IAAA,+IAAc,EAAC;IACf,IAAA,+IAAc,EAAC,CAAC,QAAQ,EAAE,WAAW;IAErC,0CAA0C;IAC1C,OAAO;QACL,GAAG,UAAU;QACb,WAAW,IAAI;IACjB;AACF;AAGO,eAAe,wBACpB,SAAiB;IAEjB,MAAM,IAAI,GACP,UAAU,CAAC,mBACX,KAAK,CAAC,aAAa,MAAM,UAAU,WAAW,GAAG,IAAI;IACxD,MAAM,gBAAgB,MAAM,EAAE,GAAG;IACjC,MAAM,WAAsB,EAAE;IAC9B,cAAc,OAAO,CAAC,CAAC;QACrB,MAAM,OAAO,IAAI,IAAI;QACrB,MAAM,YAAY,KAAK,SAAS;QAChC,SAAS,IAAI,CAAC;YACZ,IAAI,IAAI,EAAE;YACV,SAAS,KAAK,OAAO;YACrB,WAAW,KAAK,SAAS;YACzB,WAAW,WAAW;QACxB;IACF;IACA,OAAO,SAAS,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS;AAC1D;AAEO,eAAe,eAAe,EAAU;IAC7C,MAAM,SAAS,GAAG,UAAU,CAAC,mBAAmB,GAAG,CAAC;IACpD,MAAM,UAAU,MAAM,OAAO,GAAG;IAEhC,IAAI,QAAQ,MAAM,EAAE;QAClB,MAAM,OAAO,QAAQ,IAAI;QACzB,IAAI,MAAM;YACR,MAAM,YAAY,KAAK,SAAS;YAChC,OAAO;gBACL,IAAI,QAAQ,EAAE;gBACd,SAAS,KAAK,OAAO;gBACrB,WAAW,KAAK,SAAS;gBACzB,WAAW,WAAW;YACxB;QACF;IACF,OAAO;QACL,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,gBAAgB,MAAM,GAAG,UAAU,CAAC,mBAAmB,GAAG;IAChE,MAAM,eAAe,IAAI;IAEzB,cAAc,OAAO,CAAC,CAAC;QACrB,MAAM,YAAY,IAAI,IAAI,GAAG,SAAS;QACtC,IAAI,WAAW;YACb,aAAa,GAAG,CAAC,WAAW,CAAC,aAAa,GAAG,CAAC,cAAc,CAAC,IAAI;QACnE;IACF;IAEA,OAAO,MAAM,IAAI,CAAC,aAAa,OAAO,IAAI,GAAG,CAAC,CAAC,CAAC,MAAM,aAAa,GAAK,CAAC;YACvE;YACA;QACF,CAAC;AACH;;;IArFsB;IA6BA;IAqBA;IAoBA;;AAtEA,+OAAA;AA6BA,+OAAA;AAqBA,+OAAA;AAoBA,+OAAA","debugId":null}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/browse/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getRecipients as '008753800acff8bfc4cd0a1c177396368377675363'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/browse/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/browse/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/browse/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA2R,GACxT,yDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 200, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/browse/page.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/browse/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/browse/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAuQ,GACpS,qCACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 214, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}